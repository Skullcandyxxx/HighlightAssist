"""HighlightAssist System Tray Icon
Beautiful tray icon matching popup/overlay purple gradient theme
"""
import os
import sys
from pathlib import Path
from typing import Optional

try:
    import pystray
    from PIL import Image, ImageDraw, ImageFont
    HAS_TRAY = True
except ImportError:
    HAS_TRAY = False
    print("âš ï¸  pystray not installed. System tray icon disabled.")
    print("   Install with: pip install pystray pillow")


class HighlightAssistTray:
    """System tray icon with purple gradient theme matching popup/overlay"""
    
    def __init__(self, bridge_controller, notifier, service_manager=None):
        self.bridge = bridge_controller
        self.notifier = notifier
        self.service_manager = service_manager
        self.icon: Optional[pystray.Icon] = None
        self._running = False
        
    def create_icon_image(self, status: str = 'idle') -> Image.Image:
        """Create beautiful gradient icon matching popup theme
        
        Args:
            status: 'idle' (gray), 'active' (purple), 'error' (red)
        """
        # Create 64x64 icon (high-DPI support)
        size = 64
        image = Image.new('RGBA', (size, size), (0, 0, 0, 0))
        draw = ImageDraw.Draw(image)
        
        # Color schemes matching popup.html gradients
        colors = {
            'idle': {
                'start': (148, 163, 184),  # #94a3b8 (slate)
                'end': (100, 116, 139),     # #64748b (darker slate)
                'accent': (226, 232, 240)   # #e2e8f0 (light)
            },
            'active': {
                'start': (139, 92, 246),    # #8b5cf6 (purple from popup)
                'end': (124, 58, 237),      # #7c3aed (darker purple)
                'accent': (233, 213, 255)   # #e9d5ff (light purple)
            },
            'error': {
                'start': (239, 68, 68),     # #ef4444 (red)
                'end': (220, 38, 38),       # #dc2626 (darker red)
                'accent': (254, 202, 202)   # #fecaca (light red)
            }
        }
        
        color_scheme = colors.get(status, colors['idle'])
        
        # Draw circular gradient background
        for i in range(size):
            # Gradient from center to edge
            progress = i / size
            r = int(color_scheme['start'][0] + (color_scheme['end'][0] - color_scheme['start'][0]) * progress)
            g = int(color_scheme['start'][1] + (color_scheme['end'][1] - color_scheme['start'][1]) * progress)
            b = int(color_scheme['start'][2] + (color_scheme['end'][2] - color_scheme['start'][2]) * progress)
            
            # Draw circle with gradient
            draw.ellipse(
                [i//2, i//2, size - i//2, size - i//2],
                fill=(r, g, b, 255),
                outline=None
            )
        
        # Draw "H" letter in center (HighlightAssist logo)
        try:
            # Try to use system font
            font_size = 36
            font = ImageFont.truetype("arial.ttf", font_size)
        except:
            # Fallback to default font
            font = ImageFont.load_default()
        
        # Draw white "H" in center
        text = "H"
        # Get text bounding box
        bbox = draw.textbbox((0, 0), text, font=font)
        text_width = bbox[2] - bbox[0]
        text_height = bbox[3] - bbox[1]
        
        # Center the text
        x = (size - text_width) // 2
        y = (size - text_height) // 2 - 2  # Slight adjustment
        
        # Draw text with shadow for depth
        draw.text((x+1, y+1), text, fill=(0, 0, 0, 80), font=font)  # Shadow
        draw.text((x, y), text, fill=(255, 255, 255, 255), font=font)  # White text
        
        return image
    
    def create_menu(self) -> pystray.Menu:
        """Create context menu matching extension theme"""
        return pystray.Menu(
            pystray.MenuItem(
                'ğŸ¨ HighlightAssist',
                lambda: None,
                enabled=False  # Title item (disabled)
            ),
            pystray.Menu.SEPARATOR,
            pystray.MenuItem(
                'â–¶ï¸  Start Bridge',
                self._on_start,
                enabled=lambda item: not self.bridge.is_running
            ),
            pystray.MenuItem(
                'â¸ï¸  Stop Bridge',
                self._on_stop,
                enabled=lambda item: self.bridge.is_running
            ),
            pystray.MenuItem(
                'ğŸ”„ Restart Bridge',
                self._on_restart,
                enabled=lambda item: self.bridge.is_running
            ),
            pystray.Menu.SEPARATOR,
            pystray.MenuItem(
                'ï¿½ Auto-start Bridge',
                self._on_toggle_autostart,
                checked=lambda item: self.service_manager.auto_start_bridge if self.service_manager else True,
                enabled=lambda item: self.service_manager is not None
            ),
            pystray.Menu.SEPARATOR,
            pystray.MenuItem(
                ' Status',
                self._on_status,
                default=True  # Double-click action
            ),
            pystray.MenuItem(
                'ï¿½ Projects',
                self._create_projects_submenu
            ),
            pystray.MenuItem(
                'ï¿½ğŸ“‚ Open Logs',
                self._on_open_logs
            ),
            pystray.Menu.SEPARATOR,
            pystray.MenuItem(
                'âŒ Exit',
                self._on_exit
            )
        )
    
    def _create_projects_submenu(self) -> pystray.Menu:
        """Create dynamic projects submenu"""
        try:
            if not self.service_manager or not hasattr(self.service_manager, 'project_manager'):
                return pystray.Menu(
                    pystray.MenuItem('No projects available', lambda icon, item: None, enabled=False)
                )
            
            # Get recent projects
            projects = self.service_manager.project_manager.projects[:5]
            
            items = [
                pystray.MenuItem('ğŸ” Scan for Projects', self._on_scan_projects),
                pystray.Menu.SEPARATOR
            ]
            
            if projects:
                for project in projects:
                    name = project.get('name', 'Unknown')[:25]  # Truncate long names
                    framework = project.get('framework', '')
                    port = project.get('dev_port')
                    
                    # Framework emoji
                    emoji = {'Vite': 'âš¡', 'React': 'âš›ï¸', 'Next.js': 'â–²', 'Vue': 'ğŸ’š'}.get(framework, 'ğŸ“¦')
                    label = f"{emoji} {name}"
                    if port:
                        label += f" :{port}"
                    
                    items.append(pystray.MenuItem(label, lambda i, it, p=project: self._on_open_project(p)))
            else:
                items.append(pystray.MenuItem('No recent projects', lambda i, it: None, enabled=False))
            
            return pystray.Menu(*items)
            
        except Exception as e:
            import logging
            logging.getLogger(__name__).error(f'Error creating projects menu: {e}')
            return pystray.Menu(pystray.MenuItem('Error', lambda i, it: None, enabled=False))
    
    def _on_scan_projects(self, icon, item):
        """Scan common directories for projects"""
        try:
            self.notifier.notify('HighlightAssist', 'Scanning for projects...')
            
            def scan():
                try:
                    pm = self.service_manager.project_manager
                    projects = pm.scan_common_directories()
                    for p in projects:
                        pm.add_recent_project(p)
                    self.notifier.notify('HighlightAssist', f'Found {len(projects)} projects')
                    if self.icon:
                        self.icon.update_menu()
                except Exception as e:
                    import logging
                    logging.getLogger(__name__).error(f'Scan error: {e}')
            
            import threading
            threading.Thread(target=scan, daemon=True).start()
        except Exception as e:
            import logging
            logging.getLogger(__name__).error(f'Scan trigger error: {e}')
    
    def _on_open_project(self, project: dict):
        """Open project URL in browser"""
        try:
            port = project.get('dev_port')
            name = project.get('name', 'project')
            
            if port:
                import webbrowser
                url = f'http://localhost:{port}'
                webbrowser.open(url)
                self.service_manager.project_manager.add_recent_project(project)
                self.notifier.notify('HighlightAssist', f'Opening {name}')
            else:
                self.notifier.notify('HighlightAssist', f'No default port for {name}')
        except Exception as e:
            import logging
            logging.getLogger(__name__).error(f'Open project error: {e}')
    
    def _on_start(self, icon, item):
        """Start bridge server"""
        result = self.bridge.start()
        if result['status'] == 'started':
            self.notifier.notify('HighlightAssist', f'âœ… Bridge started on port {self.bridge.port}')
            # Update icon to purple (active state)
            if self.icon:
                self.icon.icon = self.create_icon_image('active')
        elif result['status'] == 'already_running':
            self.notifier.notify('HighlightAssist', f'Bridge already running on port {self.bridge.port}')
            # Make sure icon is purple if bridge is running
            if self.icon:
                self.icon.icon = self.create_icon_image('active')
        else:
            self.notifier.notify('HighlightAssist', f'âŒ Failed to start: {result.get("error", "Unknown")}')
            # Keep icon gray on error
            if self.icon:
                self.icon.icon = self.create_icon_image('error')
    
    def _on_stop(self, icon, item):
        """Stop bridge server"""
        result = self.bridge.stop()
        if result['status'] == 'stopped':
            self.notifier.notify('HighlightAssist', 'â¸ï¸  Bridge stopped')
            # Update icon to gray (idle state)
            if self.icon:
                self.icon.icon = self.create_icon_image('idle')
        elif result['status'] == 'not_running':
            self.notifier.notify('HighlightAssist', 'Bridge is not running')
            # Make sure icon is gray
            if self.icon:
                self.icon.icon = self.create_icon_image('idle')
        else:
            self.notifier.notify('HighlightAssist', f'âŒ Failed to stop: {result.get("error", "Unknown")}')
    
    def _on_restart(self, icon, item):
        """Restart bridge server"""
        result = self.bridge.restart()
        if result['status'] == 'started':
            self.notifier.notify('HighlightAssist', 'ğŸ”„ Bridge restarted')
            # Update icon to purple (active state)
            if self.icon:
                self.icon.icon = self.create_icon_image('active')
        else:
            self.notifier.notify('HighlightAssist', f'âŒ Failed to restart: {result.get("error", "Unknown")}')
            # Update to error state
            if self.icon:
                self.icon.icon = self.create_icon_image('error')
    
    def _on_toggle_autostart(self, icon, item):
        """Toggle auto-start bridge setting"""
        if not self.service_manager:
            return
        
        # Toggle the setting
        self.service_manager.auto_start_bridge = not self.service_manager.auto_start_bridge
        
        # Notify user
        status = "enabled" if self.service_manager.auto_start_bridge else "disabled"
        self.notifier.notify('HighlightAssist', f'Auto-start bridge {status}')
        
        # Update menu (pystray will refresh the checked state)
        if self.icon:
            self.icon.update_menu()
            
    def _on_status(self, icon, item):
        """Show status window"""
        import logging
        import threading
        logger = logging.getLogger(__name__)
        
        try:
            is_running = self.bridge.is_running
            status = "ğŸŸ¢ Running" if is_running else "âš« Stopped"
            
            if is_running:
                port_info = f"Port: {self.bridge.port}"
                # Check if running in-process (thread) or as subprocess
                if self.bridge._thread and self.bridge._thread.is_alive():
                    mode_info = "Mode: In-process (thread)"
                elif self.bridge.pid:
                    mode_info = f"PID: {self.bridge.pid}"
                else:
                    mode_info = "Mode: Active"
                
                uptime = self.bridge.get_uptime()
                uptime_info = f"Uptime: {int(uptime)}s" if uptime > 0 else ""
                
                message = f"{status}\n{port_info}\n{mode_info}\n{uptime_info}".strip()
            else:
                message = status
            
            logger.info(f'Status check: {message}')
            
            # Show status window in separate thread (non-blocking)
            threading.Thread(
                target=self._show_status_window,
                args=(status, is_running, message),
                daemon=True
            ).start()
                    
        except Exception as e:
            logger.exception(f'Error in _on_status: {e}')
    
    def _show_status_window(self, status: str, is_running: bool, details: str):
        """Show beautiful status window with gradient background and animations"""
        try:
            import tkinter as tk
            from tkinter import ttk
            
            # Create window
            root = tk.Tk()
            root.title("HighlightAssist Status")
            root.overrideredirect(True)  # Remove window decorations for modern look
            root.attributes('-alpha', 0.0)  # Start invisible for fade-in effect
            
            # Window dimensions
            window_width = 500
            window_height = 380
            
            # Store current state for updates
            current_state = {'is_running': is_running, 'details': details, 'canvas': None}
            
            def update_status():
                """Update status display every second"""
                try:
                    # Check current bridge status
                    new_is_running = self.bridge.is_running
                    
                    if new_is_running:
                        port_info = f"Port: {self.bridge.port}"
                        if self.bridge._thread and self.bridge._thread.is_alive():
                            mode_info = "Mode: In-process (thread)"
                        elif self.bridge.pid:
                            mode_info = f"PID: {self.bridge.pid}"
                        else:
                            mode_info = "Mode: Active"
                        
                        uptime = self.bridge.get_uptime()
                        uptime_info = f"Uptime: {int(uptime)}s" if uptime > 0 else ""
                        new_details = f"ğŸŸ¢ Running\n{port_info}\n{mode_info}\n{uptime_info}".strip()
                    else:
                        new_details = "âš« Stopped"
                    
                    # If status changed, redraw
                    if new_is_running != current_state['is_running'] or new_details != current_state['details']:
                        current_state['is_running'] = new_is_running
                        current_state['details'] = new_details
                        redraw_canvas(new_is_running, new_details)
                    
                    # Schedule next update
                    root.after(1000, update_status)
                except:
                    pass  # Window might be closing
            
            def redraw_canvas(is_running, details):
                """Redraw the entire canvas with new status"""
                canvas = current_state['canvas']
                if not canvas:
                    return
                
                canvas.delete("all")  # Clear canvas
                
                # Draw gradient background with more colors
                if is_running:
                    colors = [
                        "#a855f7", "#9333ea", "#7c3aed", "#6d28d9", "#5b21b6", "#4c1d95"
                    ]
                else:
                    colors = [
                        "#64748b", "#475569", "#334155", "#1e293b", "#0f172a", "#020617"
                    ]
                
                # Create ultra-smooth gradient
                num_bars = 100
                for i in range(num_bars):
                    ratio = i / num_bars
                    color_idx = int(ratio * (len(colors) - 1))
                    next_idx = min(color_idx + 1, len(colors) - 1)
                    local_ratio = (ratio * (len(colors) - 1)) - color_idx
                    
                    r1, g1, b1 = int(colors[color_idx][1:3], 16), int(colors[color_idx][3:5], 16), int(colors[color_idx][5:7], 16)
                    r2, g2, b2 = int(colors[next_idx][1:3], 16), int(colors[next_idx][3:5], 16), int(colors[next_idx][5:7], 16)
                    
                    r = int(r1 + (r2 - r1) * local_ratio)
                    g = int(g1 + (g2 - g1) * local_ratio)
                    b = int(b1 + (b2 - b1) * local_ratio)
                    
                    color = f"#{r:02x}{g:02x}{b:02x}"
                    y_pos = i * (window_height / num_bars)
                    canvas.create_rectangle(0, y_pos, window_width, y_pos + window_height/num_bars + 1,
                                          fill=color, outline=color)
                
                # Add border
                border_color = "#a78bfa" if is_running else "#475569"
                canvas.create_rectangle(2, 2, window_width-2, window_height-2,
                                      fill='', outline=border_color, width=3)
                
                # Title section
                canvas.create_text(window_width // 2, 60, text="ğŸ¨",
                                 font=("Segoe UI Emoji", 48), fill="white", anchor=tk.CENTER)
                
                canvas.create_text(window_width // 2, 120, text="HighlightAssist",
                                 font=("Segoe UI", 28, "bold"), fill="white", anchor=tk.CENTER)
                
                canvas.create_text(window_width // 2, 155, text="Visual UI Debugger v2.0",
                                 font=("Segoe UI", 11), fill="#c7d2fe" if is_running else "#94a3b8", anchor=tk.CENTER)
                
                # Decorative line
                canvas.create_line(100, 180, window_width - 100, 180,
                                 fill="#c7d2fe" if is_running else "#475569", width=2)
                
                # Status badge
                badge_y = 220
                badge_width = 200
                badge_height = 50
                badge_x = (window_width - badge_width) // 2
                glow_color = "#10b981" if is_running else "#ef4444"
                
                # Glow effect
                for offset in range(4, 0, -1):
                    canvas.create_oval(badge_x - offset*2, badge_y - offset*2,
                                     badge_x + badge_width + offset*2, badge_y + badge_height + offset*2,
                                     fill='', outline=glow_color, width=1)
                
                # Badge shape
                canvas.create_oval(badge_x, badge_y, badge_x + badge_height, badge_y + badge_height,
                                 fill=glow_color, outline='')
                canvas.create_rectangle(badge_x + badge_height//2, badge_y,
                                      badge_x + badge_width - badge_height//2, badge_y + badge_height,
                                      fill=glow_color, outline='')
                canvas.create_oval(badge_x + badge_width - badge_height, badge_y,
                                 badge_x + badge_width, badge_y + badge_height,
                                 fill=glow_color, outline='')
                
                # Status text
                status_emoji = "ğŸŸ¢" if is_running else "âš«"
                status_text = "RUNNING" if is_running else "STOPPED"
                
                canvas.create_text(window_width // 2 + 2, badge_y + 27,
                                 text=f"{status_emoji} {status_text}",
                                 font=("Segoe UI", 16, "bold"), fill="#1e293b", anchor=tk.CENTER)
                canvas.create_text(window_width // 2, badge_y + 25,
                                 text=f"{status_emoji} {status_text}",
                                 font=("Segoe UI", 16, "bold"), fill="white", anchor=tk.CENTER)
                
                # Details
                if is_running:
                    details_y = 290
                    detail_lines = details.split('\n')[1:]
                    
                    for idx, line in enumerate(detail_lines):
                        if line.strip():
                            parts = line.strip().split(':', 1)
                            if len(parts) == 2:
                                key, value = parts
                                icon = "ğŸ“¡" if "Port" in key else "âš™ï¸" if "Mode" in key else "â±ï¸"
                                canvas.create_text(window_width // 2, details_y + (idx * 28),
                                                 text=f"{icon}  {key.strip()}: {value.strip()}",
                                                 font=("Segoe UI", 12), fill="#e0e7ff", anchor=tk.CENTER)
                
                # Close button
                draw_close_button(canvas)
            
            def draw_close_button(canvas):
                """Draw close button with hover handling"""
                close_y = window_height - 45
                close_width = 140
                close_height = 36
                close_x = (window_width - close_width) // 2
                
                # Button shadow
                canvas.create_oval(close_x + 2, close_y + 2, close_x + close_height + 2, close_y + close_height + 2,
                                 fill="#1e293b", outline='', tags='close_shadow')
                canvas.create_rectangle(close_x + close_height//2 + 2, close_y + 2,
                                      close_x + close_width - close_height//2 + 2, close_y + close_height + 2,
                                      fill="#1e293b", outline='', tags='close_shadow')
                canvas.create_oval(close_x + close_width - close_height + 2, close_y + 2,
                                 close_x + close_width + 2, close_y + close_height + 2,
                                 fill="#1e293b", outline='', tags='close_shadow')
                
                # Button parts
                btn_ids = [
                    canvas.create_oval(close_x, close_y, close_x + close_height, close_y + close_height,
                                     fill="#52525b", outline='', tags='close_btn'),
                    canvas.create_rectangle(close_x + close_height//2, close_y,
                                          close_x + close_width - close_height//2, close_y + close_height,
                                          fill="#52525b", outline='', tags='close_btn'),
                    canvas.create_oval(close_x + close_width - close_height, close_y,
                                     close_x + close_width, close_y + close_height,
                                     fill="#52525b", outline='', tags='close_btn')
                ]
                
                text_id = canvas.create_text(window_width // 2, close_y + 18, text="âœ•  Close",
                                           font=("Segoe UI", 12, "bold"), fill="white",
                                           anchor=tk.CENTER, tags='close_text')
                
                def on_hover(e):
                    canvas.itemconfig('close_btn', fill="#7c3aed")
                    canvas.itemconfig('close_text', fill="#fbbf24")
                
                def on_leave(e):
                    canvas.itemconfig('close_btn', fill="#52525b")
                    canvas.itemconfig('close_text', fill="white")
                
                def on_click(e):
                    fade_out()
                
                for item in ['close_btn', 'close_text']:
                    canvas.tag_bind(item, '<Enter>', on_hover)
                    canvas.tag_bind(item, '<Leave>', on_leave)
                    canvas.tag_bind(item, '<Button-1>', on_click)
            
            # Center window
            screen_width = root.winfo_screenwidth()
            screen_height = root.winfo_screenheight()
            x = (screen_width - window_width) // 2
            y = (screen_height - window_height) // 2
            root.geometry(f"{window_width}x{window_height}+{x}+{y}")
            
            # Create canvas
            canvas = tk.Canvas(root, width=window_width, height=window_height,
                             highlightthickness=0, bg='black')
            canvas.pack(fill=tk.BOTH, expand=True)
            
            # Store canvas reference for updates
            current_state['canvas'] = canvas
            
            # Initial draw
            redraw_canvas(is_running, details)
            
            # Make window draggable
            def start_drag(event):
                root._drag_start_x = event.x
                root._drag_start_y = event.y
            
            def on_drag(event):
                x = root.winfo_x() + (event.x - root._drag_start_x)
                y = root.winfo_y() + (event.y - root._drag_start_y)
                root.geometry(f"+{x}+{y}")
            
            canvas.bind('<Button-1>', start_drag)
            canvas.bind('<B1-Motion>', on_drag)
            
            # Fade-in animation
            def fade_in(alpha=0.0):
                if alpha < 1.0:
                    alpha += 0.05
                    root.attributes('-alpha', alpha)
                    root.after(20, lambda: fade_in(alpha))
            
            def fade_out():
                def fade_step(alpha=1.0):
                    if alpha > 0.0:
                        alpha -= 0.05
                        root.attributes('-alpha', alpha)
                        root.after(20, lambda: fade_step(alpha))
                    else:
                        root.destroy()
                fade_step()
            
            # Start fade-in
            fade_in()
            
            # Start status updates
            root.after(1000, update_status)
            
            # Auto-close after 30 seconds
            root.after(30000, fade_out)
            
            # Make window draggable
            def start_move(event):
                root.x = event.x
                root.y = event.y
                
            def do_move(event):
                deltax = event.x - root.x
                deltay = event.y - root.y
                x = root.winfo_x() + deltax
                y = root.winfo_y() + deltay
                root.geometry(f"+{x}+{y}")
                
            canvas.bind('<Button-1>', start_move)
            canvas.bind('<B1-Motion>', do_move)
            
            # Run window
            root.mainloop()
            
        except Exception as e:
            import logging
            logging.getLogger(__name__).error(f'Failed to show status window: {e}')
            # Fallback to message box
            try:
                import ctypes
                ctypes.windll.user32.MessageBoxW(0, details, "HighlightAssist Status", 0x40)
            except:
                pass
    
    def _on_open_logs(self, icon, item):
        """Open log directory"""
        log_dir = Path.home() / '.highlightassist' / 'logs'
        if sys.platform.startswith('win'):
            log_dir = Path(os.environ.get('LOCALAPPDATA', '.')) / 'HighlightAssist' / 'logs'
        
        if log_dir.exists():
            if sys.platform.startswith('win'):
                os.startfile(log_dir)
            elif sys.platform == 'darwin':
                os.system(f'open "{log_dir}"')
            else:
                os.system(f'xdg-open "{log_dir}"')
    
    def _on_exit(self, icon, item):
        """Exit application"""
        self.notifier.notify('HighlightAssist', 'ğŸ‘‹ Shutting down...')
        if self.bridge.is_running:
            self.bridge.stop()
        icon.stop()
        self._running = False
    
    def run(self):
        """Start system tray icon (blocking)"""
        if not HAS_TRAY:
            print("âŒ Cannot start tray icon - pystray not installed")
            return
        
        # Determine initial icon state based on bridge status
        initial_state = 'active' if self.bridge.is_running else 'idle'
        initial_icon = self.create_icon_image(initial_state)
        
        # Create tray icon
        self.icon = pystray.Icon(
            'HighlightAssist',
            initial_icon,
            'HighlightAssist - Visual UI Debugger',
            menu=self.create_menu()
        )
        
        self._running = True
        status = "ğŸŸ¢ Bridge running" if self.bridge.is_running else "âš« Bridge stopped"
        print(f"ğŸ¨ System tray icon started (purple gradient theme) - {status}")
        print("   Right-click icon for menu")
        print("   Double-click for status")
        
        # Run (blocks until icon.stop() called)
        self.icon.run()
    
    def stop(self):
        """Stop tray icon"""
        if self.icon:
            self.icon.stop()
            self._running = False


def main():
    """Standalone tray icon test"""
    from core.bridge_controller import BridgeController
    from core.notifier import NotificationManager
    
    bridge = BridgeController(port=5055)
    notifier = NotificationManager()
    
    tray = HighlightAssistTray(bridge, notifier)
    
    print("""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘        HighlightAssist System Tray v1.0                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¨ Theme: Purple gradient (matches popup/overlay)
ğŸ“ Tray icon active in system tray
ğŸ–±ï¸  Right-click for menu
ğŸ‘† Double-click for status

Menu Options:
  â–¶ï¸  Start Bridge - Launch WebSocket server
  â¸ï¸  Stop Bridge - Stop server
  ğŸ”„ Restart Bridge - Restart server
  ğŸ“Š Status - Show current status
  ğŸ“‚ Open Logs - Open log directory
  âŒ Exit - Close application
    """)
    
    try:
        tray.run()
    except KeyboardInterrupt:
        print("\nğŸ‘‹ Shutting down...")
        tray.stop()


# NOTE: main() is for standalone testing only
# When used in service_manager_v2.py, the tray is created and run from there
# if __name__ == '__main__':
#     main()
